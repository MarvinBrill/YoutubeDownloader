{"version":3,"file":"index.js","mappings":";;;;;;;;;;;;;;;;;AAAiD;AACG;;AAEpD,eAAe,+CAAY;;AAE3B;AACA;AACA,IAAI,0DAAiB;AACrB;;AAEA,iEAAe,MAAM;;;;;;;;;;;;;;;;;;;;ACVQ;AACK;AACd;;AAEpB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,uBAAuB,wDAAY,OAAO,wBAAwB;;AAElE;AACA;AACA;AACA;AACA;AACA,mBAAmB,iEAAqB,QAAQ,wBAAwB;AACxE,mCAAmC,kCAAkC;;AAErE,IAAI,oDAAM;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,+BAA+B,wCAAwC;AACvE;AACA;AACA,KAAK;AACL;;AAEA,iEAAe,iBAAiB;;;;;;;;;;;;;;ACtCjB;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACnBA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;;;;ACNwC;AAChB;AACA;AACqC;AAC3B;;AAElC;AACA,gBAAgB,8CAAO;AACvB,mBAAmB,wDAAiB;;AAEpC;AACA,QAAQ,2CAAI;AACZ,QAAQ,sEAAc;AACtB,QAAQ,6CAAI;AACZ,QAAQ,mDAAM;AACd;;AAEA;AACA;AACA,KAAK;AACL;;AAEA,O","sources":["webpack://backend/./src/web/Router.js","webpack://backend/./src/web/YoutubeDownloader.js","webpack://backend/./src/web/middleware/corsMiddleware.js","webpack://backend/external commonjs \"cors\"","webpack://backend/external commonjs \"express\"","webpack://backend/external commonjs \"fluent-ffmpeg\"","webpack://backend/external commonjs \"ytdl-core\"","webpack://backend/external node-commonjs \"fs\"","webpack://backend/external node-commonjs \"http\"","webpack://backend/webpack/bootstrap","webpack://backend/webpack/runtime/compat get default export","webpack://backend/webpack/runtime/define property getters","webpack://backend/webpack/runtime/hasOwnProperty shorthand","webpack://backend/webpack/runtime/make namespace object","webpack://backend/./src/index.js"],"sourcesContent":["import { Router as createRouter } from 'express';\nimport YoutubeDownloader from './YoutubeDownloader';\n\nconst router = createRouter();\n\nrouter.get(\n    '/download',\n    YoutubeDownloader\n)\n\nexport default router;","import ytdl from \"ytdl-core\";\nimport ffmpeg from \"fluent-ffmpeg\"\nimport fs from \"fs\";\n\nconst YoutubeDownloader = async (req, res) => {\n    const url = req.query.url;\n\n    if(!url || !url.includes(\"https://www.youtube\")) {\n        res.status(400).end();\n        return;\n    }\n    \n    const info = await ytdl.getInfo(url, {quality: \"highestaudio\"});\n\n    if(!info) {\n        res.status(400).end();\n        return;\n    }\n    \n    const stream = ytdl.downloadFromInfo(info, {quality: \"highestaudio\"});\n    const tmpFileName = `/tmp/yt-${Math.floor(Math.random() * 10000)}.mp3`;\n\n    ffmpeg(stream)\n    .audioBitrate(info.formats[0].audioBitrate)\n    .withAudioCodec(\"libmp3lame\")\n    .toFormat(\"mp3\")\n    .saveToFile(tmpFileName)\n    .on(\"error\", e => {\n        console.log(e)\n        res.status(400);\n    })\n    .on(\"end\", () => {\n        res.set(\"filename\", `${info.player_response.videoDetails.title}.mp3`);\n        res.download(tmpFileName);\n        res.status(200);\n    });\n};\n\nexport default YoutubeDownloader;","export default function corsMiddleware(\n  req,\n  res,\n  next,\n) {\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Access-Control-Expose-Headers', '*');\n  res.setHeader(\n    'Access-Control-Allow-Headers',\n    'Origin, Content-Type, Accept, Token',\n  );\n  res.setHeader('Access-Control-Allow-Credentials', 'true');\n  res.setHeader(\n    'Access-Control-Allow-Methods',\n    'GET, POST',\n  );\n  res.setHeader('Access-Control-Max-Age', '86400');\n  res.setHeader('Cache-Control', 'no-store');\n  next();\n}\n","module.exports = require(\"cors\");","module.exports = require(\"express\");","module.exports = require(\"fluent-ffmpeg\");","module.exports = require(\"ytdl-core\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import express, { json } from 'express';\nimport http from 'http';\nimport cors from 'cors';\nimport corsMiddleware from './web/middleware/corsMiddleware';\nimport router from './web/Router';\n\nconst main = async () => {\n    const app = express();\n    const server = http.createServer(app);\n\n    app.use(\n        cors(),\n        corsMiddleware,\n        json(),\n        router\n    )\n\n    server.listen(8000, () => {\n        console.log(`Server started`);\n    });\n}\n\nmain();"],"names":[],"sourceRoot":""}